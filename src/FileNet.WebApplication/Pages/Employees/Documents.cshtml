@page "{id:guid}"
@model FileNet.WebApplication.Pages.Employees.DocumentsModel
@{
    ViewData["Title"] = "Employee Documents";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <h2 class="mb-0">Documents</h2>
            @if (Model.Employee is not null)
            {
                <div class="text-muted">
                    @Model.Employee.FirstName @Model.Employee.LastName
                    <span class="mx-1">•</span>
                    <small>NationalCode: @Model.Employee.NationalCode</small>
                </div>
            }
        </div>
        <a class="btn btn-outline-secondary" asp-page="Index">Back</a>
    </div>

    @if (!string.IsNullOrWhiteSpace(Model.Success))
    {
        <div class="alert alert-success">@Model.Success</div>
    }
    @if (!string.IsNullOrWhiteSpace(Model.Error))
    {
        <div class="alert alert-danger">@Model.Error</div>
    }

    <div class="card mb-4">
        <div class="card-header">Upload new document</div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" asp-page-handler="Upload">
                <div asp-validation-summary="ModelOnly" class="text-danger mb-2"></div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label asp-for="Input.Title" class="form-label"></label>
                        <input asp-for="Input.Title" class="form-control" />
                        <span asp-validation-for="Input.Title" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label asp-for="Input.Category" class="form-label">Category</label>
                        <select asp-for="Input.Category" class="form-select">
                            @foreach (var c in FileNet.WebApplication.Pages.Employees.DocumentsModel.Categories)
                            {
                                <option value="@c.Value">@c.Name</option>
                            }
                        </select>
                        <span asp-validation-for="Input.Category" class="text-danger"></span>
                    </div>
                    <div class="col-md-3">
                        <label asp-for="Input.File" class="form-label">File</label>
                        <input asp-for="Input.File" class="form-control" type="file" />
                        <span asp-validation-for="Input.File" class="text-danger"></span>
                    </div>
                </div>
                <div class="mt-3">
                    <button type="submit" class="btn btn-primary">Upload</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Files (@Model.Docs.Count)</div>
        <div class="card-body p-0">
            <table class="table table-striped mb-0 align-middle">
                <thead>
                    <tr>
                        <th style="width:1%">#</th>
                        <th>Title</th>
                        <th>Category</th>
                        <th>FileName</th>
                        <th>Size</th>
                        <th>Type</th>
                        <th>Created</th>
                        <th style="width:1%"></th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var i = 1;
                        foreach (var d in Model.Docs)
                        {
                            <tr>
                                <td>@i</td>
                                <td>@(d.Title ?? "-")</td>
                                <td>@d.Category</td>
                                <td>@d.FileName</td>
                                <td>@(String.Format("{0:N0}", d.Size)) B</td>
                                <td>@d.ContentType</td>
                                <td>@d.UploadedOn.LocalDateTime</td>
                                <td class="text-nowrap">
                                    <a class="btn btn-sm btn-outline-primary"
                                       asp-page-handler="Download"
                                       asp-route-id="@Model.EmployeeId"
                                       asp-route-docId="@d.Id">Download</a>

                                    <form method="post" asp-page-handler="Delete"
                                          asp-route-id="@Model.EmployeeId"
                                          asp-route-docId="@d.Id" class="d-inline"
                                          onsubmit="return confirm('Delete this document?');">
                                        <button class="btn btn-sm btn-outline-danger">Delete</button>
                                    </form>
                                </td>
                            </tr>
                            i++;
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
